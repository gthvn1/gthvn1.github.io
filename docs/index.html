<!DOCTYPE html>
<head>
    <style>
        body {
            background: #181818;
            color: #FFF;
            font-family: Arial, sans-serif;
        }

        .checked {
            text-decoration: line-through;
        }

        button {
              background-color: #4CAF50; /* Green */
              color: white;
              padding: 15px 32px;
              text-align: center;
              display: inline-block;
              font-size: 16px;
        }
    </style>
</head>

<body>
    <p>
    Currently we are just testing how Webassembly interact with javascript. We start
    with simple things like computing the Fibonacci sequence and step by step we will
    try to code a simple game in Webassembly.
    </p>
    <ul>
        <li class="checked">Use wasm to compute Fibonacci sequence</li>
        <li class="checked">Exports function into JS</li>
        <li> Use memory to exchange data between Wasm and JS</li>
        <li> Play with Canvas</li>
        <ul>
            <li>clean canvas</li>
            <li>draw something</li>
            <li>move it with the mouse</li>
            <li> ... <i>next steps to be considered</i> ...</li>
        </ul>
    </ul>
    <button>
        Click to get the next number of the Fibonaci sequence
    </button>
    <p>
        Fibonaci(<span id="n">0</span>) = <span id="fib">0</span>
    </p>
    <script>
        let bytes = new Uint8Array([
            0x00,0x61,0x73,0x6d,0x01,0x00,0x00,0x00,0x01,0x06,0x01,0x60,0x01,0x7e,0x01,0x7e,0x03,0x02,0x01,0x00,0x07,0x08,0x01,0x04,0x66,0x69,0x62,0x6f,0x00,0x00,0x0a,0x3f,0x01,0x3d,0x01,0x04,0x7e,0x20,0x00,0x42,0x01,0x57,0x04,0x40,0x20,0x00,0x0f,0x0b,0x42,0x01,0x21,0x01,0x42,0x01,0x21,0x02,0x42,0x00,0x21,0x03,0x03,0x40,0x20,0x03,0x21,0x04,0x20,0x02,0x21,0x03,0x20,0x02,0x20,0x04,0x7c,0x21,0x02,0x20,0x01,0x42,0x01,0x7c,0x21,0x01,0x20,0x00,0x20,0x01,0x52,0x0d,0x00,0x0b,0x20,0x02,0x0b
        ]);

        (async function start() {
            const {module, instance} = await WebAssembly.instantiate(bytes);
            const exports = instance.exports;

            let $ = document.querySelector.bind(document);
            let n = 0;

            $('button').addEventListener('click', event => {
                n++;
                $('#n').textContent = `${n}`;
                $('#fib').textContent = exports.fibo(BigInt(n));
            });
        })();
    </script>
</body>
